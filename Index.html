import React, { useState, useEffect } from "react";

const recipesData = [
  {
    id: 1,
    title: "Spaghetti Bolognese",
    category: "Italian",
    ingredients: ["Spaghetti", "Minced beef", "Tomato sauce"],
    instructions: "Cook pasta. Fry beef. Mix with sauce.",
  },
  {
    id: 2,
    title: "Chicken Curry",
    category: "Indian",
    ingredients: ["Chicken", "Curry powder", "Coconut milk"],
    instructions: "Cook chicken. Add spices. Pour coconut milk.",
  },
  {
    id: 3,
    title: "Tacos",
    category: "Mexican",
    ingredients: ["Tortillas", "Beef", "Lettuce", "Cheese"],
    instructions: "Cook beef. Fill tortillas. Add toppings.",
  },
];

function App() {
  const [searchTerm, setSearchTerm] = useState("");
  const [selectedCategory, setSelectedCategory] = useState("All");
  const [savedRecipes, setSavedRecipes] = useState([]);
  const [visibleInstructions, setVisibleInstructions] = useState([]);
  const [checkedItems, setCheckedItems] = useState({});

  useEffect(() => {
    const saved = JSON.parse(localStorage.getItem("savedRecipes")) || [];
    setSavedRecipes(saved);
  }, []);

  const toggleSaveRecipe = (id) => {
    let updated = [...savedRecipes];
    if (updated.includes(id)) {
      updated = updated.filter((rid) => rid !== id);
    } else {
      updated.push(id);
    }
    setSavedRecipes(updated);
    localStorage.setItem("savedRecipes", JSON.stringify(updated));
  };

  const toggleInstructions = (id) => {
    setVisibleInstructions((prev) =>
      prev.includes(id) ? prev.filter((i) => i !== id) : [...prev, id]
    );
  };

  const toggleCheck = (recipeId, item) => {
    setCheckedItems((prev) => {
      const key = `${recipeId}-${item}`;
      return {
        ...prev,
        [key]: !prev[key],
      };
    });
  };

  const filteredRecipes = recipesData.filter((recipe) => {
    const matchesSearch = recipe.title.toLowerCase().includes(searchTerm.toLowerCase());
    const matchesCategory = selectedCategory === "All" || recipe.category === selectedCategory;
    return matchesSearch && matchesCategory;
  });

  const categories = ["All", ...new Set(recipesData.map((r) => r.category))];

  return (
    <div className="App">
      <h1>Recipe App</h1>

      <input
        type="text"
        placeholder="Search recipes..."
        value={searchTerm}
        onChange={(e) => setSearchTerm(e.target.value)}
      />

      <select value={selectedCategory} onChange={(e) => setSelectedCategory(e.target.value)}>
        {categories.map((cat, idx) => (
          <option key={idx} value={cat}>
            {cat}
          </option>
        ))}
      </select>

      {filteredRecipes.map((recipe) => (
        <div key={recipe.id} className="recipe">
          <h2>{recipe.title}</h2>
          <p>Category: {recipe.category}</p>

          <button onClick={() => toggleSaveRecipe(recipe.id)}>
            {savedRecipes.includes(recipe.id) ? "Unsave" : "Save"}
          </button>

          <h4>Ingredients:</h4>
          <ul>
            {recipe.ingredients.map((item, i) => {
              const key = `${recipe.id}-${item}`;
              return (
                <li key={i}>
                  <label>
                    <input
                      type="checkbox"
                      checked={!!checkedItems[key]}
                      onChange={() => toggleCheck(recipe.id, item)}
                    />
                    {item}
                  </label>
                </li>
              );
            })}
          </ul>

          <button onClick={() => toggleInstructions(recipe.id)}>
            {visibleInstructions.includes(recipe.id) ? "Hide Instructions" : "Show Instructions"}
          </button>

          {visibleInstructions.includes(recipe.id) && (
            <p><strong>Instructions:</strong> {recipe.instructions}</p>
          )}
        </div>
      ))}
      <style>
        {`
          .App {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 700px;
            margin: auto;
          }

          input, select {
            padding: 8px;
            margin: 10px 5px;
          }

          .recipe {
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.05);
          }

          button {
            margin: 10px 0;
            padding: 5px 10px;
          }
        `}
      </style>
    </div>
  );
}

.App {
  font-family: Arial, sans-serif;
  padding: 20px;
  max-width: 700px;
  margin: auto;
}

input, select {
  padding: 8px;
  margin: 10px 5px;
}

.recipe {
  border: 1px solid #ddd;
  border-radius: 10px;
  padding: 15px;
  margin-top: 20px;
  box-shadow: 2px 2px 10px rgba(0,0,0,0.05);
}

button {
  margin: 10px 0;
  padding: 5px 10px;
}


export default App;
